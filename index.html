<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>NFC Battle Game</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white flex flex-col items-center justify-center min-h-screen p-4">
  <div class="w-full max-w-md bg-gray-800 rounded-2xl shadow-lg p-6 space-y-4">
    <h1 class="text-2xl font-bold text-center text-yellow-400">‚öîÔ∏è NFC Battle Game ‚öîÔ∏è</h1>
    <div class="text-center">
      <p id="hpDisplay" class="text-xl">HP: 20</p>
      <div class="w-full bg-gray-700 rounded-full h-4">
        <div id="hpBar" class="bg-green-500 h-4 rounded-full transition-all" style="width:100%"></div>
      </div>
    </div>
    <div class="flex justify-between text-sm text-gray-300">
      <span id="criticalStatus">‚Äî</span>
      <span id="logStatus">Waiting...</span>
    </div>
    <div id="gameLog" class="bg-gray-700 rounded-lg p-2 h-40 overflow-y-auto text-sm"></div>
    <button id="startBtn" class="w-full bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-2 px-4 rounded-lg">Start NFC Battle</button>
    <p class="text-xs text-gray-400 text-center">
      Scan an NFC card with text like ATTACK3, HEAL2, BOOST, WEAKEN, CRITICAL, REFLECT, COUNTER, LIFESTEAL, SWAP, REVIVE, GAMBLE
    </p>
  </div>

  <script>
  class Player {
    constructor() {
      this.maxHp = 20;
      this.hp = 20;
      this.activeEffect = null; // store string like "BOOST", "WEAKEN"
    }

    setActiveEffect(effect) {
      // clear previous
      this.activeEffect = effect || null;
      document.getElementById("criticalStatus").textContent = this.activeEffect || "‚Äî";
    }

    clearEffect() {
      this.setActiveEffect(null);
    }

    addToLog(msg) {
      const log = document.getElementById("gameLog");
      const line = document.createElement("div");
      line.textContent = msg;
      log.appendChild(line);
      log.scrollTop = log.scrollHeight;
      document.getElementById("logStatus").textContent = msg;
    }

    updateHP() {
      this.hp = Math.max(0, Math.min(this.hp, this.maxHp));
      document.getElementById("hpDisplay").textContent = `HP: ${this.hp}`;
      const percent = (this.hp / this.maxHp) * 100;
      const bar = document.getElementById("hpBar");
      bar.style.width = percent + "%";
      bar.className = "h-4 rounded-full transition-all " +
        (percent > 50 ? "bg-green-500" : percent > 20 ? "bg-yellow-500" : "bg-red-500");
    }

    handleAttack(amount) {
      if (this.hp <= 0) return this.addToLog("üíÄ You are defeated!");

      let dmg = amount;

      // Apply one active effect if present
      switch (this.activeEffect) {
        case "CRITICAL":
          dmg *= 2;
          this.addToLog("‚öîÔ∏è CRITICAL HIT!");
          break;
        case "BOOST":
          dmg += 2;
          this.addToLog("üí™ BOOSTED attack!");
          break;
        case "WEAKEN":
          dmg = Math.max(1, dmg - 2);
          this.addToLog("üòµ Weakened attack!");
          break;
        case "COUNTER":
          this.addToLog("üõ°Ô∏è Counter prepared! Attack reflected!");
          // Instead of taking damage, reflect it back
          dmg = 0;
          break;
        case "REFLECT":
          this.addToLog("üîÆ Reflect spell active! Attack bounced!");
          dmg = 0;
          break;
        case "LIFESTEAL":
          this.addToLog("ü©∏ LifeSteal! Healing equal to damage.");
          this.hp = Math.min(this.maxHp, this.hp + dmg);
          break;
        default:
          break;
      }

      // Clear effect after use
      this.clearEffect();

      // Apply damage (if any left)
      if (dmg > 0) {
        this.hp = Math.max(0, this.hp - dmg);
        this.addToLog(`üí• Took ${dmg} damage!`);
      }
      this.updateHP();
    }

    handleHeal(amount) {
      if (this.hp <= 0) return this.addToLog("üíÄ You are defeated!");
      this.hp = Math.min(this.maxHp, this.hp + amount);
      this.addToLog(`üíñ Healed ${amount} HP!`);
      this.updateHP();
      this.clearEffect(); // healing also clears active effect
    }

    handleCritical() { this.setActiveEffect("CRITICAL"); this.addToLog("‚öîÔ∏è Next attack will be CRITICAL!"); }
    handleBoost() { this.setActiveEffect("BOOST"); this.addToLog("üí™ Next attack is BOOSTED!"); }
    handleWeaken() { this.setActiveEffect("WEAKEN"); this.addToLog("üòµ Next attack is WEAKENED!"); }
    handleCounter() { this.setActiveEffect("COUNTER"); this.addToLog("üõ°Ô∏è COUNTER set!"); }
    handleReflect() { this.setActiveEffect("REFLECT"); this.addToLog("üîÆ REFLECT ready!"); }
    handleLifesteal() { this.setActiveEffect("LIFESTEAL"); this.addToLog("ü©∏ LIFESTEAL primed!"); }
    handleRevive() { this.setActiveEffect("REVIVE"); this.addToLog("‚ú® REVIVE prepared! If you fall, you'll return!"); }

    handleSwap() {
      const lost = this.maxHp - this.hp;
      this.hp = lost;
      this.addToLog("üîÑ SWAP! HP swapped with missing HP.");
      this.updateHP();
      this.clearEffect();
    }

    handleGamble() {
      const coin = Math.random() < 0.5 ? "loss" : "gain";
      const amt = Math.floor(Math.random() * 5) + 1;
      if (coin === "loss") {
        this.hp = Math.max(0, this.hp - amt);
        this.addToLog(`üé≤ Gamble failed! Lost ${amt} HP`);
      } else {
        this.hp = Math.min(this.maxHp, this.hp + amt);
        this.addToLog(`üé≤ Gamble won! Gained ${amt} HP`);
      }
      this.updateHP();
      this.clearEffect();
    }
  }

  const player = new Player();

  async function startNFC() {
    if (!("NDEFReader" in window)) {
      player.addToLog("‚ùå NFC not supported in this browser!");
      return;
    }
    try {
      const reader = new NDEFReader();
      await reader.scan();
      player.addToLog("üì° NFC Scan started! Scan a card...");
      reader.onreading = (event) => {
        const decoder = new TextDecoder();
        for (const record of event.message.records) {
          if (record.recordType === "text") {
            const txt = decoder.decode(record.data).trim().toUpperCase();
            player.addToLog(`üìñ Scanned: ${txt}`);
            processCard(txt);
          }
        }
      };
    } catch (err) {
      player.addToLog("‚ö†Ô∏è NFC Scan failed: " + err);
    }
  }

  function processCard(txt) {
    if (txt.startsWith("ATTACK")) {
      const val = parseInt(txt.replace("ATTACK", "")) || 1;
      player.handleAttack(val);
    } else if (txt.startsWith("HEAL")) {
      const val = parseInt(txt.replace("HEAL", "")) || 1;
      player.handleHeal(val);
    } else {
      switch (txt) {
        case "CRITICAL": player.handleCritical(); break;
        case "BOOST": player.handleBoost(); break;
        case "WEAKEN": player.handleWeaken(); break;
        case "COUNTER": player.handleCounter(); break;
        case "REFLECT": player.handleReflect(); break;
        case "LIFESTEAL": player.handleLifesteal(); break;
        case "REVIVE": player.handleRevive(); break;
        case "SWAP": player.handleSwap(); break;
        case "GAMBLE": player.handleGamble(); break;
        default: player.addToLog("‚ùì Unknown card: " + txt);
      }
    }
  }

  document.getElementById("startBtn").addEventListener("click", startNFC);
  player.updateHP();
  </script>
</body>
</html>

